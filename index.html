<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Global Market Dashboard</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body{
  background:#020617;
  color:#e5e7eb;
  font-family:system-ui;
  display:flex;
  justify-content:center;
  padding:30px;
}
.card{
  background:#0f172a;
  border:1px solid #1f2937;
  border-radius:20px;
  padding:20px;
  width:520px;
}
.row{
  display:flex;
  justify-content:space-between;
  padding:10px;
  border-radius:10px;
  cursor:pointer;
}
.row:hover{background:#020617}
small{color:#94a3b8}
input,button{
  background:#020617;
  border:1px solid #1f2937;
  color:#fff;
  padding:8px;
  border-radius:10px;
}
canvas{margin-top:15px}
</style>
</head>
<body>

<div class="card">
<h2>ğŸŒ Global Market Dashboard</h2>

<div class="row">ğŸ’µ USD â†’ INR <span id="usd">loading...</span></div>
<div class="row">ğŸŸ¨ Gold <span id="gold">loading...</span></div>
<div class="row">ğŸª™ Silver <span id="silver">loading...</span></div>
<div class="row">ğŸŸ« Copper <span id="copper">loading...</span></div>
<div class="row">ğŸ›¢ Crude Oil <span id="crude">loading...</span></div>

<hr style="border-color:#1f2937">

<input id="alertInput" placeholder="Gold alert â‚¹/gram">
<button onclick="setAlert()">ğŸ”” Set Gold Alert</button>
<div id="alertStatus"><small>No alert set</small></div>

<canvas id="chart" height="120"></canvas>

<p><small>Auto refresh every 60 seconds</small></p>
</div>

<script>
let alertTarget = null;

async function fetchJSON(url){
  const r = await fetch(url);
  return await r.json();
}

async function refresh(){
  try{
    // USDINR
    let fx = await fetchJSON("https://api.exchangerate.host/latest?base=USD&symbols=INR");
    let usd = fx.rates.INR;

    // Metals.live (free public JSON)
    let metals = await fetchJSON("https://api.metals.live/v1/spot");

    let gold = metals.find(x=>x[0]==="gold")[1];   // USD/oz
    let silver = metals.find(x=>x[0]==="silver")[1];
    let copper = metals.find(x=>x[0]==="copper")[1]; // USD/lb

    // Crude (stooq proxy)
    let crudeTxt = await fetch("https://stooq.com/q/l/?s=cl.f&i=d").then(r=>r.text());
    let crude = parseFloat(crudeTxt.split("\n")[1].split(",")[4]);

    // conversions
    let goldInr = (gold*usd)/31.1035;
    let silverInr = (silver*usd)*32.1507;
    let copperInr = (copper*usd)*2.20462;
    let crudeInr = (crude*usd)/159;

    usd.textContent = `â‚¹${usd.toFixed(2)}`;
    gold.textContent = `$${gold.toFixed(2)}/oz â†’ â‚¹${goldInr.toFixed(2)}/g`;
    silver.textContent = `$${silver.toFixed(2)}/oz â†’ â‚¹${silverInr.toFixed(0)}/kg`;
    copper.textContent = `$${copper.toFixed(2)}/lb â†’ â‚¹${copperInr.toFixed(0)}/kg`;
    crude.textContent = `$${crude.toFixed(2)}/bbl â†’ â‚¹${crudeInr.toFixed(2)}/L`;

    localStorage.setItem("lastData", JSON.stringify({usd,gold,silver,copper,crude}));

    if(alertTarget && goldInr>=alertTarget){
      alert("ğŸ”” Gold crossed â‚¹"+goldInr.toFixed(2));
      alertTarget=null;
    }

  }catch(e){
    let cached = JSON.parse(localStorage.getItem("lastData")||"{}");
    if(cached.usd){
      usd.textContent = `â‚¹${cached.usd.toFixed(2)} (cached)`;
      gold.textContent = `$${cached.gold.toFixed(2)} (cached)`;
      silver.textContent = `$${cached.silver.toFixed(2)} (cached)`;
      copper.textContent = `$${cached.copper.toFixed(2)} (cached)`;
      crude.textContent = `$${cached.crude.toFixed(2)} (cached)`;
    }else{
      document.body.innerHTML="<h2 style='color:red'>All APIs blocked temporarily. Try again later.</h2>";
    }
  }
}

function setAlert(){
  alertTarget=parseFloat(alertInput.value);
  alertStatus.innerHTML="<small>Alert set at â‚¹"+alertTarget+"</small>";
}

refresh();
setInterval(refresh,60000);
</script>
</body>
</html>
